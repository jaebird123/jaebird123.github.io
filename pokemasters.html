<!doctype html>

<html lang="en">
<head><style>
    html * {
        color: #000;
        font-family: Arial;
    }
    html {
        background-color: #ecf0f1;
    }
    h2 {
        padding-top: 20px;
        margin-bottom: 0px;
    }
    body > p {
        margin-top: 5px;
    }
    #tournaments table,
    #drafts      table,
    #trades      table {
        margin-top: 20px;
        margin-bottom: 20px;
    }
    #tournaments table tr:first-child td,
    #drafts      table tr:first-child td,
    #trades      table tr:first-child td {
        font-weight: bold;
        padding-bottom: 8px;
    }
    #tournaments table tr:not(:first-child) td,
    #drafts      table tr:not(:first-child) td {
        padding-right: 30px;
    }
    #tournaments table tr:not(:first-child) td:nth-child(3),
    #trades      table tr:not(:first-child) td:nth-child(3) {
        text-align: center;
    }
    #tournaments table tr.winner {
        font-weight: bold;
    }
    #tournaments div.match {
        width: 20px;
        height: 20px;
        display: inline-block;
        margin-right: 20px;
        text-align: center;
    }
    #tournaments div.match.win {
        background-color: #2ecc71;
    }
    #tournaments div.match.loss {
        background-color: #e74c3c;
    }
    #tournaments div.match.none {
        visibility: hidden;
    }
    #drafts {
        max-width: 400px;
    }
    #drafts table tr:not(:first-child) td {
        padding-bottom: 10px;
    }
    #trades table tr:not(:first-child) td {
        padding-left: 10px;
        padding-right: 10px;
    }
    .pokemon-img {
        border-radius: 50%;
    }
    .pokemon-img.kamon, #tournaments table tr.winner.kamon, #drafts table tr.kamon, #trades table tr.kamon {
        background: radial-gradient(#e74c3c 5%, #ecf0f1 70%);
    }
    .pokemon-img.jbird, #tournaments table tr.winner.jbird, #drafts table tr.jbird, #trades table tr.jbird {
        background: radial-gradient(#f1c40f 15%, #ecf0f1 70%);
    }
    .pokemon-img.steve, #tournaments table tr.winner.steve, #drafts table tr.steve, #trades table tr.steve {
        background: radial-gradient(#9b59b6 5%, #ecf0f1 70%);
    }
    .pokemon-img.james, #tournaments table tr.winner.james, #drafts table tr.james, #trades table tr.james {
        background: radial-gradient(#74b9ff 15%, #ecf0f1 70%);
    }
</style></head>

<body>
    <h1>Season 4 of Pokemasters</h1>
    <h2>Kamon</h2>
    <p class="kamon player-description">[my description]</p>
    <div id="kamon-pokemon"></div>

    <h2>JaeBird's Pokemon</h2>
    <p class="jbird player-description">[my description]</p>
    <div id="jbird-pokemon"></div>

    <h2>Steve's Pokemon</h2>
    <p class="steve player-description">[my description]</p>
    <div id="steve-pokemon"></div>

    <h2>James's Pokemon</h2>
    <p class="james player-description">[my description]</p>
    <div id="james-pokemon"></div>

    <div>
        <h2>Tournaments</h2>
        <div id="tournaments"></div>
    </div>

    <div>
        <h2>Drafts</h2>
        <div id="drafts"></div>
    </div>

    <div>
        <h2>Trades</h2>
        <div id="trades"></div>
    </div>
<script>
    var player_names = ['Kamon', 'JaeBird', 'Steve', 'James'];
    var player_class = ['kamon', 'jbird', 'steve', 'james'];

    var player_pokemon = [
        [6, 65, 68, 115, 130, 142, 143, 145, 149, 157, 176, 184, 196, 197, 230, 237, 282, 289, 303, 356, 357, 376, 398, 405, 409, 461, 497, 534, 545, 567, 571, 579, 598, 612, 635, 655, 660, 663, 693, 695, 697],
        [9, 38, 80, 82, 94, 103, 110, 127, 131, 144, 160, 169, 208, 212, 214, 227, 233, 235, 242, 248, 254, 260, 344, 350, 395, 437, 445, 460, 464, 466, 467, 468, 473, 479, 547, 560, 561, 589, 591, 609, 625, 637, 658, 681, 683, 691, 703, 707, 709],
        [3, 12, 34, 53, 59, 101, 132, 146, 199, 229, 257, 302, 308, 346, 373, 424, 448, 472, 474, 475, 620, 652, 687, 700, 715],
        [483, 484, 485, 486, 487, 493]
    ];

    var tournaments = [
        {
            "date": '1993/01/20',
            "teams": [
                [6, 65, 68, 115, 130, 142],
                [9, 38, 80, 82, 94, 103],
                [3, 12, 34, 53, 59, 101],
                [483, 484, 485, 486, 487, 493]
            ],
            "matches": [
                // winner, loser
                [3, 0], // James beat Kamon
                [3, 1], // James beat JaeBird
                [3, 2],
                [1, 2],
                [1, 0],
                [2, 0]
            ]
        },
        {
            "date": '1993/05/03',
            "teams": [
                [6, 65, 68, 115, 130, 142],
                [9, 38, 80, 82, 94, 103],
                [3, 12, 34, 53, 59, 101],
                [483, 484, 485, 486, 487, 493]
            ],
            "matches": [
                [1, 0],
                [1, 2],
                [3, 1],
                [0, 2],
                [0, 3],
                [3, 2],
                [1, 3],
                [0, 3],
                [1, 0]
            ]
        }
    ]

    var drafts = [
        [
            '1993/01/01', // Date
            [6],          // kamon_pkmn_1, ..., kamon_pkmn_m
            [9],          // jbird_pkmn_1, ..., jbird_pkmn_n
            [3],          // steve_pkmn_1, ..., steve_pkmn_o
            []            // james_pkmn_1, ..., james_pkmn_p
        ],
        [
            '1993/01/02',
            [65, 68, 115, 130, 142, 143, 145, 149, 157, 176, 184, 196, 197, 230, 237, 282, 289, 303, 356, 357, 376, 398, 405, 409, 461, 497, 534, 545, 567, 571, 579, 598, 612, 635, 655, 660, 663, 693, 695, 697],
            [38, 80, 82, 94, 103, 110, 127, 131, 144, 160, 169, 208, 212, 214, 227, 233, 235, 242, 248, 254, 260, 344, 350, 395, 437, 445, 460, 464, 466, 467, 468, 473, 479, 547, 560, 561, 589, 591, 609, 625, 637, 658, 681, 683, 691, 703, 707, 709],
            [12, 34, 53, 59, 101, 132, 146, 199, 229, 257, 302, 308, 346, 373, 424, 448, 472, 474, 475, 620, 652, 687, 700, 715],
            [483, 484, 485, 486, 487, 493]
        ]
    ]

    var trades = [
        [
            '1994/01/01', // Date
            [6, 0, 1],    // pkmn_1, from_player_id, to_player_id (ex: Charizard from Kamon to JaeBird)
            [9, 1, 2],    // pkmn_2, from_player_id, to_player_id (ex: Blastoise from JaeBird to Steve)
            [3, 2, 0],    // pkmn_3, from_player_id, to_player_id (ex: Venausaur from Steve to Kamon)
            [479, 1, 3]   // pkmn_4, from_player_id, to_player_id (ex: Rotom from JaeBird to James)
        ],                // ...
        [
            '1994/01/02',
            [115, 0, 1],
            [376, 0, 1],
            [663, 0, 1],
            [169, 1, 0]
        ]
    ]


    function pad(num, size) {
        var s = "000000000" + num;
        return s.substr(s.length-size);
    }

    function setPokemon(player_pokemon_div, player_pokemon, classes) {
        for (var i = 0; i < player_pokemon.length; i++) {
            var tmp = document.createElement('img')
            tmp.src = "https://www.serebii.net/sunmoon/pokemon/" + pad(player_pokemon[i], 3) + ".png";
            for (var j = 0; j < classes.length; j++) {
                tmp.classList.add(classes[j]);
            }
            player_pokemon_div.appendChild(tmp);
        }
    }

    function setTournaments(tournaments, player_names, player_class) {
        tournaments_dom = document.getElementById("tournaments");
        for (var i = tournaments.length-1; i >= 0; i--) {
            var table, tbody;
            var tourny = tournaments[i];
            [table, tbody] = make_table_with_header('Tournament '+(i+1)+', '+tourny["date"], "3");

            var header_row = document.createElement('tr');
            header_row.appendChild(make_dom_element('td', 'Player'));
            header_row.appendChild(make_dom_element('td', 'Pokemon'));
            header_row.appendChild(make_dom_element('td', 'Wins'));
            header_row.appendChild(make_dom_element('td', 'Matches'));

            // Figure out the winner. Append 'winner' onto their list of classes to be used for their tr in the table
            var row_classes = player_class.slice();
            var n_wins = [];
            var matches = []; // 1: Win, -1: Loss: 0: No participation
            for (var j = 0; j < player_names.length; j++) {
                n_wins[j] = 0;
                matches[j] = [];
                for (var k = 0; k < tourny["matches"].length; k++) {
                    var match = tourny["matches"][k];
                    if (match[0] == j) { // Won
                        matches[j][k] = 1;
                    } else if (match[1] == j) { // Lost
                        matches[j][k] = -1;
                    } else {
                        matches[j][k] = 0
                    }
                }
            }

            for (var j = 0; j < tourny["matches"].length; j++) {
                var match = tourny["matches"][j];
                n_wins[match[0]] += 1;
            }
            winner_index = index_of_max(n_wins);
            row_classes[winner_index] = row_classes[winner_index] + ' winner';

            // Make a row for each player in the table
            tbody.appendChild(header_row);
            for (var j = 0; j < player_names.length; j++) {
                var player_row = make_tournament_table_row(player_names[j], tourny["teams"][j], n_wins[j], matches[j], row_classes[j]);
                tbody.appendChild(player_row);
            }
            tournaments_dom.appendChild(table);
        }
    }

    function make_tournament_table_row(player, pokemon, wins, matches, cls) {
        var row = document.createElement('tr');
        var player_div = document.createElement('td');
        player_div.innerHTML = player;
        var pokemon_div = document.createElement('td');
        for (var i = 0; i < pokemon.length; i++) {
            pokemon_div.appendChild(get_pokemon_icon(pokemon[i]));
        }
        var wins_div = document.createElement('td');
        wins_div.innerHTML = wins;
        var matches_div = document.createElement('td');
        matches_div.appendChild(make_matches_div(matches));
        row.appendChild(player_div);
        row.appendChild(pokemon_div);
        row.appendChild(wins_div);
        row.appendChild(matches_div);
        var classes = cls.split(' ');
        for (var i = 0; i < classes.length; i++) {
            row.classList.add(classes[i]);
        }
        return row;
    }

    function make_matches_div(matches) {
        var wrapper = document.createElement('div');
        for (var i = 0; i < matches.length; i++) {
            var match_div = document.createElement('div');
            match_div.classList.add('match');
            if (matches[i] == 1) {
                match_div.classList.add('win');
                match_div.innerHTML = 'W';
            } else if (matches[i] == -1) {
                match_div.classList.add('loss');
                match_div.innerHTML = 'L';
            } else {
                match_div.classList.add('none');
            }
            wrapper.appendChild(match_div);
        }
        return wrapper;
    }

    function make_table_with_header(header_text, n_cols) {
        var table = document.createElement('table');
        var tbody = document.createElement('tbody');
        table.appendChild(tbody);
        var tr = document.createElement('tr');
        tbody.appendChild(tr);
        var td = make_dom_element('td', header_text);
        tr.appendChild(td);
        td.setAttribute("colspan", n_cols);
        return [table, tbody]
    }

    function setDrafts(drafts, player_names, player_class) {
        drafts_dom = document.getElementById("drafts");
        for (var i = drafts.length-1; i >= 0; i--) {
            var table, tbody;
            [table, tbody] = make_table_with_header('Draft '+(i+1)+', '+drafts[i][0], "2");

            var header_row = document.createElement('tr');
            header_row.appendChild(make_dom_element('td', 'Player'));
            header_row.appendChild(make_dom_element('td', 'Pokemon'));
            tbody.appendChild(header_row);

            // Make a row for each player in the table
            var table_rows = []
            for (var j = 0; j < player_names.length; j++) {
                var row = make_draft_table_row(player_names[j], drafts[i][j+1]);
                row.className = player_class[j];
                tbody.appendChild(row);
            }
            table.appendChild(tbody);
            drafts_dom.appendChild(table);
        }
    }

    function make_draft_table_row(player, pokemon) {
        var row = document.createElement('tr');
        var player_div = document.createElement('td');
        player_div.innerHTML = player;
        var pokemon_div = document.createElement('td');
        for (var i = 0; i < pokemon.length; i++) {
            pokemon_div.appendChild(get_pokemon_icon(pokemon[i]));
        }
        row.appendChild(player_div);
        row.appendChild(pokemon_div);
        return row;
    }

    function setTrades(trades, player_names, player_class) {
        trades_dom = document.getElementById("trades");
        for (var i = trades.length-1; i >= 0; i--) {
            var table, tbody;
            [table, tbody] = make_table_with_header('Trade '+(i+1)+', '+trades[i][0], "4");
            trades_dom.append(table);

            var header_row = document.createElement('tr');
            header_row.appendChild(make_dom_element('td', 'From'));
            header_row.appendChild(make_dom_element('td', ''));
            header_row.appendChild(make_dom_element('td', 'Pokemon'));
            header_row.appendChild(make_dom_element('td', ''));
            header_row.appendChild(make_dom_element('td', 'To'));
            tbody.appendChild(header_row);

            for (var j = 1; j < trades[i].length; j++) {
                var tr = document.createElement('tr');
                tbody.appendChild(tr);
                var from_player_idx = trades[i][j][1];
                var to_player_idx = trades[i][j][2];
                tr.appendChild(make_dom_element('td', player_names[from_player_idx]));
                tr.appendChild(get_pokemon_icon_td(trades[i][j][0]));
                tr.appendChild(make_dom_element('td', "→"));
                tr.appendChild(get_pokemon_icon_td(trades[i][j][0]));
                tr.appendChild(make_dom_element('td', player_names[to_player_idx]));
                tr.className = player_class[to_player_idx];
            }
        }
    }

    function setPlayerDescriptions(player_class) {
        for (var i = 0; i < player_class.length; i++) {
            var n_tournament_wins = document.querySelectorAll('.winner.' + player_class[i]).length;
            var n_pokemon = document.querySelectorAll('.pokemon-img.' + player_class[i]).length;
            var n_match_wins = 0;
            var match_win_doms = document.querySelectorAll('#tournaments tr.' + player_class[i] + ' td:nth-child(3)');
            for (var j = 0; j < match_win_doms.length; j++) {
                n_match_wins += parseInt(match_win_doms[j].innerHTML);
            }
            var description_dom = document.querySelectorAll('.player-description.' + player_class[i])[0];
            description_dom.innerHTML = n_tournament_wins + ' Tournament Wins, ' + n_match_wins + ' Match Wins, ' + n_pokemon + ' Pokemon';
        }
    }

    function get_pokemon_icon_td(pokemon_number) {
        var img = get_pokemon_icon(pokemon_number);
        var td = document.createElement('td');
        td.appendChild(img);
        return td;
    }

    function get_pokemon_icon(pokemon_number) {
        var img = document.createElement('img');
        img.src = "https://www.serebii.net/pokedex-sm/icon/" + pad(pokemon_number, 3) + ".png";
        return img;
    }

    function createElementFromHTML(htmlString) {
        var div = document.createElement('div');
        div.innerHTML = htmlString.trim();
        return div.firstChild; 
    }

    function make_dom_element(tag, innerHTML) {
        var dom_element = document.createElement(tag);
        dom_element.innerHTML = innerHTML;
        return dom_element;
    }

    function index_of_max(arr) {
        imax = 0;
        for (var i = 1; i < arr.length; i++) {
            if (arr[i] > arr[imax]) {
                imax = i;
            }
        }
        return imax;
    }

    for (var i = 0; i < player_pokemon.length; i++) {
        var player_pokemon_div = document.getElementById(player_class[i] + "-pokemon");
        setPokemon(player_pokemon_div, player_pokemon[i], ["pokemon-img", player_class[i]]);
    }

    setTournaments(tournaments, player_names, player_class);
    setDrafts(drafts, player_names, player_class);
    setTrades(trades, player_names, player_class);
    setPlayerDescriptions(player_class);
</script>
</body>
</html>